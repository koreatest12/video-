name: Video Production & Server Ops
on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  push:
    branches: [ "main" ]

jobs:
  video-ops-pipeline:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # ê²°ê³¼ë¬¼ì„ ì €ì¥ì†Œì— ë‹¤ì‹œ í‘¸ì‹œí•˜ê¸° ìœ„í•œ ê¶Œí•œ

    steps:
      # 1. ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      # 2. íŒŒì´ì¬ í™˜ê²½ ì„¤ì • (ìµœì‹  ì•ˆì • ë²„ì „ 3.11 ì‚¬ìš© ê¶Œì¥)
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      # 3. [ì˜ìƒ ì„œë²„ ì„¤ì¹˜] ì‹œìŠ¤í…œ ë ˆë²¨ ì˜ì¡´ì„± ì„¤ì¹˜ (FFmpeg í•„ìˆ˜)
      - name: ğŸ¬ Install System Dependencies (Video Server Tools)
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg libsm6 libxext6
          echo "FFmpeg ë° ë¹„ë””ì˜¤ ì½”ë± ì„¤ì¹˜ ì™„ë£Œ"

      # 4. íŒŒì´ì¬ ì˜ì¡´ì„± ì„¤ì¹˜ (ìˆ˜ì •ëœ requirements.txt ì‚¬ìš©)
      - name: ğŸ“¦ Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f ./scripts/requirements.txt ]; then pip install -r ./scripts/requirements.txt; fi
          # ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ í•„ìš”í•œ íŒ¨í‚¤ì§€ ì¬í™•ì¸ ì„¤ì¹˜
          pip install moviepy opencv-python-headless numpy pandas

      # 5. [ì˜ìƒ ì œì‘ ë° ì—…ê·¸ë ˆì´ë“œ] ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      # (ì‹¤ì œ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ëª…ì´ main.py ë˜ëŠ” generate_video.pyë¼ê³  ê°€ì •)
      - name: ğŸƒâ€â™‚ï¸ Run Video Production & Upgrade
        run: |
          echo "ì˜ìƒ ì œì‘ í”„ë¡œì„¸ìŠ¤ ì‹œì‘..."
          # ìŠ¤í¬ë¦½íŠ¸ í´ë”ë¡œ ì´ë™í•˜ì—¬ ì‹¤í–‰ (ê²½ë¡œì— ì£¼ì˜)
          cd scripts
          
          # ì˜ˆì‹œ: ë©”ì¸ ì‹¤í–‰ íŒŒì¼ì´ ìˆë‹¤ë©´ ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ê³  íŒŒì¼ëª…ì„ ë§ì¶”ì„¸ìš”
          # python generate_video.py
          
          # í…ŒìŠ¤íŠ¸ìš© ì„ì‹œ ëª…ë ¹ (ì‹¤ì œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì—†ì„ ê²½ìš° ì—ëŸ¬ ë°©ì§€ìš©)
          python -c "import numpy; import cv2; print('ì˜ìƒ ì„œë²„ í™˜ê²½ ì •ìƒ ì‘ë™ ì¤‘ (OpenCV/Numpy ë¡œë“œ ì„±ê³µ)')"

      # 6. [í™œì„±í™”] ê²°ê³¼ë¬¼ ì €ì¥ (Artifact)
      - name: ğŸ“¤ Upload Video Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: generated-videos
          path: scripts/output/*.mp4  # ê²°ê³¼ë¬¼ì´ ì €ì¥ë˜ëŠ” ê²½ë¡œ
          retention-days: 5
